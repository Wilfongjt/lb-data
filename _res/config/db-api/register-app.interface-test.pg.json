{"description": ["Single table multiple interfaces"], "type": "interface", "db-prefix": "reg", "tbl-name": "register", "tbl-prefix": "reg", "tbl-tests": ["api"], "tbl-roles": ["registrant"], "dep-api-overwrite": "0", "dep-api-name": "register", "dep-api-table": "register", "dep-api-methods": ["upsert", "select"], "tbl-fields": [{"name": "id", "context": "pk", "type": "TEXT", "crud": "RI", "search-context": "text"}, {"name": "type", "context": "type", "type": "TEXT", "crud": "CRI", "search-context": "type"}, {"name": "form", "context": "form", "description": "JSON record", "type": "JSONB", "crud": "FR"}, {"name": "password", "context": "password", "description": "Passwords are stored in table row, but not in json row", "type": "TEXT", "crud": "Cu", "calculate": "encrypt(_password)"}, {"name": "active", "context": "active", "type": "BOOLEAN", "default": "true", "crud": "ru"}, {"name": "created", "context": "created", "type": "TIMESTAMP", "crud": "r"}, {"name": "updated", "context": "updated", "type": "TIMESTAMP", "crud": "r"}], "api-overwrite": "0", "api-name": "app", "api-table": "register", "api-methods": ["upsert", "select", "test"], "api-role": "anonymous", "api-version": "1.0.0", "api-privileges": [{"privilege": "EXECUTE", "type": "FUNCTION", "parameters": "JSONB", "role": "anonymous"}, {"privilege": "EXECUTE", "type": "FUNCTION", "parameters": "JSONB", "role": "api_user"}], "api-form": [{"name": "id", "context": "pk", "type": "TEXT", "json": "RI", "search": "uuid", "calculated": "uuid_generate_v4()"}, {"name": "type", "context": "type", "type": "TEXT", "json": "CRI", "const": "app"}, {"name": "app-name", "context": "name", "type": "TEXT", "json": "CRI", "default": "my-app"}, {"name": "version", "context": "version", "type": "TEXT", "default": "1.0.0", "json": "CR"}, {"name": "username", "context": "email", "type": "TEXT", "json": "Cru"}, {"name": "password", "context": "password", "description": ["Passwords are stored in table row, but not in json row", "Remove the password from form before inserting", "Remove the password from form before updating"], "type": "TEXT", "json": "CuD"}, {"name": "token", "context": "token", "type": "TEXT", "json": "r", "function": "sign(_payload, _secret)"}], "api-test-forms": [{"type": "insert", "description": "'app - insert test'::TEXT", "template": "SELECT [[api-test-forms..type:insert..is ( reg_schema.app( {{token}}, '{{form}}'::JSONB )::JSONB, {{expected}}, {{description}} );]]", "token": "sign('{{pattern}}'::json, {{password}})", "pattern": {"username": "testuser@register.com", "role": "anonymous"}, "password": "current_setting('app.jwt_secret')", "form": {"type": "app", "app-name": "my-test-app", "version": "1.0.0", "username": "testuser@register.com", "email": "test@register.com", "password": "g1G!gggg", "test": "insert"}, "expected": "'{\"msg\": \"OK\", \"status\": \"200\"}'::JSONB"}, {"type": "select", "description": "'app - select from {{tbl-name}} by id and check token'::TEXT", "template": "SELECT [[api-test-forms..type:select..matches( reg_schema.app( {{token}}, '{{form}}'::JSONB )::TEXT, {{expected}}, {{description}} );]]", "token": "sign('{{pattern}}'::json, {{password}} )", "pattern": {"username": "testuser@register.com", "role": "anonymous"}, "password": "current_setting('app.jwt_secret')", "form": {"id": "my-test-app@1.0.0"}, "expected": "'[a-zA-Z\\.0-9_]+'"}]}